<div class="employe-list-container">
  <!-- Type Switch Buttons -->
  <div class="tab-switch-container">
    <div class="tab-switch">
      <button 
        class="tab-button" 
        [ngClass]="{'active': employeType === 'interne'}"
        (click)="switchToInterne()"
      >
        Interne
      </button>
      <button 
        class="tab-button" 
        [ngClass]="{'active': employeType === 'sous-traitant'}" 
      >
        Sous-traitant
      </button>
    </div>
  </div>

  <div class="title-wrapper">
    <h1 class="page-title advanced-title">Liste des sous-traitants</h1>
  </div>

  <div class="header-section">
    <div class="search-bar">
      <span class="search-icon"><i class="fas fa-search"></i></span>
      <input 
        type="text" 
        placeholder="Rechercher..." 
        [(ngModel)]="searchQuery" 
        (input)="search()"
        class="search-input"
      />
    </div>
    <button class="add-employe-btn" *ngIf="canPerformActions" (click)="openAddEmployeModal()">
      <span class="plus-icon">+</span>Ajouter un sous-traitant
    </button>
  </div>
  
  <div class="content">
    <!-- Success Modals -->
    <div *ngIf="isSuccess" class="modal-overlay success-modal">
      <div class="modal-container">
        <div class="modal-body">
          <div class="success-content">
            <div class="check-circle">
              <span class="check-icon">✔</span>
            </div>
            <p>Le sous-traitant a été ajouté avec succès.</p>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="isSuccessModified" class="modal-overlay success-modal">
      <div class="modal-container">
        <div class="modal-body">
          <div class="success-content">
            <div class="check-circle">
              <span class="check-icon">✔</span>
            </div>
            <p>Le sous-traitant a été modifié avec succès.</p>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="isSuccessArchive" class="modal-overlay success-modal">
      <div class="modal-container">
        <div class="modal-body">
          <div class="success-content">
            <div class="check-circle">
              <span class="check-icon">✔</span>
            </div>
            <p>Le sous-traitant a été archivé avec succès.</p>
          </div>
        </div>
      </div>
    </div>
    
    <div *ngIf="showArchiveConfirmModal" class="modal-overlay confirm-modal">
      <div class="modal-container">
        <div class="modal-body">
          <div class="confirm-content">
            <div class="warning-icon">⚠️</div>
            <p>Êtes-vous sûr de vouloir archiver ce sous-traitant ?</p>
            <div class="confirm-actions">
              <button class="cancel-btn" (click)="cancelArchive()">Annuler</button>
              <button class="confirm-btn" (click)="confirmArchive()">Confirmer</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal-overlay form-modal" *ngIf="showModifyEmployeModal">
      <app-modify-employe
        [employe]="selectedEmploye"
        [employeType]="employeType"
        (close)="closeModifyUserModal()"
        (update)="updateEmploye()"
      ></app-modify-employe> 
    </div>

    <div class="table-wrapper">
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Nom de la société</th>
              <th>Adresse</th>
              <th>Représentant légal</th>
              <th>Téléphone </th>
              <th>Adresse du représentant</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            <ng-container *ngIf="filteredEmployes.length > 0">
              <tr *ngFor="let employe of employesToDisplay">
                <td>{{ employe.companyName }}</td>
                <td>{{ employe.adresse }}</td>
                <td>{{ employe.legalRepresentative }}</td>
                <td>{{ employe.telephoneRepresentant }}</td>
                <td>{{ employe.adresseRepresentant }}</td>
                <td class="actions" *ngIf="canPerformActions">
                  <button class="edit-btn" *ngIf="employe.id !== undefined" (click)="editEmploye(employe.id)">
                    <i class="fas fa-edit"></i>
                  </button>
                  <button class="delete-btn" *ngIf="employe.id !== undefined" (click)="openArchiveConfirmModal(employe.id)">
                    <i class="fas fa-archive"></i>
                  </button>
                </td>
              </tr>
            </ng-container>
            <tr *ngIf="filteredEmployes.length === 0">
              <td colspan="6" class="no-results">Aucun sous-traitant trouvé</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="pagination" *ngIf="filteredEmployes.length > 0">
      <span>Page</span>
      <button
        class="page-arrow"
        [disabled]="currentPage === 1"
        (click)="goToPage(currentPage - 1)"
      >
        <
      </button>
      <span class="page-number current">{{ currentPage }}</span>
      <button
        class="page-arrow"
        [disabled]="currentPage === totalPages"
        (click)="goToPage(currentPage + 1)"
      >
        >
      </button>
    </div>
  </div>

  <div class="modal-overlay form-modal" *ngIf="showAddEmployeModal">
    <app-add-employe 
      [employeType]="employeType"
      (close)="closeAddEmployeModal()"
      (employeAdded)="onEmployeAdded()"
    ></app-add-employe> 
  </div>
</div>