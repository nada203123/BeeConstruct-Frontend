<div class="equipment-container">
  <div class="title-wrapper">
    <h1 class="page-title advanced-title">Liste des équipements</h1>
  </div>

  <!-- Header Section -->
  <div class="header-section">
    <div class="search-bar">
      <span class="search-icon"><i class="fas fa-search"></i></span>
      <input type="text" placeholder="Rechercher un équipement..." [(ngModel)]="searchTerm" (input)="searchEquipment()">
    </div>
    <button class="add-button" *ngIf="canPerformActions" (click)="openAddPopup()">
      <span class="plus-icon">+</span> Ajouter un équipement
    </button>
  </div>

  <!-- Content Wrapper -->
  <div class="content">
    <!-- Success Popup -->
    <div class="success-popup" *ngIf="showSuccessPopup">
      <div class="success-popup-content">
        <div class="success-icon">
          <i class="fas fa-check-circle"></i>
        </div>
        <div class="success-message">{{ successMessage }}</div>
      </div>
    </div>

    <!-- Archive Confirmation Modal -->
    <div *ngIf="showArchiveConfirmModal" class="modal-overlay confirm-modal">
      <div class="modal-container">
        <div class="modal-body">
          <div class="confirm-content">
            <div class="warning-icon">⚠️</div>
            <p>Êtes-vous sûr de vouloir archiver cet équipement ?</p>
            <div class="confirm-actions">
              <button class="cancel-btn" (click)="cancelArchive()">Annuler</button>
              <button class="confirm-btn" (click)="confirmArchive()">Confirmer</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Add Equipment Popup -->
    <div class="popup" *ngIf="showAddPopup">
      <div class="popup-content">
        <div class="modal-header">
          <h3>Ajouter un équipement</h3>
          <button class="close-btn" (click)="closeAddPopup()">×</button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <input type="text" placeholder="NOM ÉQUIPEMENT" [(ngModel)]="newEquipment.name" (focus)="clearErrorMessage()">
          </div>
          <div class="form-group">
            <input type="number" placeholder="QUANTITÉ" [(ngModel)]="newEquipment.quantity" min="0" (focus)="clearErrorMessage()">
          </div>
          <div class="error-text" *ngIf="errorMessage">{{ errorMessage }}</div>
        </div>
        <div class="popup-actions">
          <button class="save-button" (click)="addEquipment()">Ajouter</button>
        </div>
      </div>
    </div>

    <!-- Modify Equipment Popup -->
    <div class="popup" *ngIf="showModifyPopup">
      <div class="popup-content">
        <div class="modal-header">
          <h3>Modifier un équipement</h3>
          <button class="close-btn" (click)="closeModifyPopup()">×</button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <input type="text" placeholder="NOM ÉQUIPEMENT" [(ngModel)]="selectedEquipment!.name" (focus)="clearErrorMessage()">
          </div>
          <div class="form-group">
            <input type="number" placeholder="QUANTITÉ" [(ngModel)]="selectedEquipment!.quantity" min="0" (focus)="clearErrorMessage()">
          </div>
          <div class="error-text" *ngIf="errorMessage">{{ errorMessage }}</div>
        </div>
        <div class="popup-actions">
          <button class="save-button" (click)="updateEquipment()">Modifier</button>
        </div>
      </div>
    </div>

    <!-- Table -->
    <div class="table-wrapper">
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Intitulé équipement</th>
              <th>Quantité</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let equipment of equipmentToDisplay">
              <td>{{ equipment.name }}</td>
              <td>
                <div class="quantity-control">
                  <button class="quantity-btn" *ngIf="canPerformActions" (click)="decrementQuantity(equipment)" [disabled]="equipment.quantity <= 0">-</button>
                  <input
                    type="number"
                    class="quantity-input"
                    [(ngModel)]="equipment.quantity"
                    (blur)="updateQuantity(equipment)"
                    (keydown.enter)="updateQuantityAndBlur($event, equipment)"
                    min="0"
                    step="1"
                    [readonly]="!canPerformActions"
                  />
                  <button class="quantity-btn" *ngIf="canPerformActions" (click)="incrementQuantity(equipment)">+</button>
                </div>
              </td>
              <td>
                <div class="action-buttons" *ngIf="canPerformActions">
                  <button class="modify-button" (click)="openModifyPopup(equipment)" title="Modifier">
                    <i class="fas fa-edit"></i>
                  </button>
                  <button class="archive-button" (click)="openArchiveConfirmModal(equipment)" title="Archiver">
                    <i class="fas fa-archive"></i>
                  </button>
                </div>
              </td>
            </tr>
            <tr *ngIf="filteredEquipment.length === 0">
              <td colspan="3" class="no-results">Aucun équipement correspondant</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Pagination -->
    <div class="pagination" *ngIf="filteredEquipment.length > 0">
      <span>Page</span>
      <button
        class="page-arrow"
        [disabled]="currentPage === 1"
        (click)="goToPage(currentPage - 1)"
      >
        <
      </button>
      <span class="page-number current">{{ currentPage }}</span>
      <button
        class="page-arrow"
        [disabled]="currentPage === totalPages"
        (click)="goToPage(currentPage + 1)"
      >
        >
      </button>
    </div>
  </div>
</div>